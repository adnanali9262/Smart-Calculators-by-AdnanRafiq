<div class="calculator" style="display:flex; flex-direction:column; gap:12px;">
  <h2>ðŸ”Œ Telecom Rectifier Calculator</h2>

  <!-- Phase selection -->
  <div style="margin-bottom:10px;">
    <label for="phaseType"><strong>Select Phase:</strong></label>
    <select id="phaseType" class="input">
      <option value="single">Single Phase</option>
      <option value="three">Three Phase</option>
    </select>
  </div>

  <div style="display:flex; justify-content:center; align-items:flex-start; gap:20px; flex-wrap:wrap;">
    
    <!-- Left Panel: AC Inputs -->
    <div style="flex:1; min-width:250px;" id="inputPanel">
      <h3>AC Input</h3>
      <div id="singlePhaseInputs" class="form-grid" style="gap:10px;">
        <div>
          <label for="acV">AC Voltage (V)</label>
          <input id="acV" class="input" type="number" placeholder="230">
        </div>
        <div>
          <label for="acI">AC Current (A)</label>
          <input id="acI" class="input" type="number" placeholder="Leave blank if unknown">
        </div>
        <div>
          <label for="pf">Power Factor</label>
          <input id="pf" class="input" type="number" step="0.01" placeholder="0â€“1">
        </div>
      </div>

      <div id="threePhaseInputs" class="form-grid" style="gap:10px; display:none;">
        <!-- Phase 1 -->
        <h4>Phase 1</h4>
        <div><label for="v1">Voltage (V)</label><input id="v1" class="input" type="number"></div>
        <div><label for="i1">Current (A)</label><input id="i1" class="input" type="number"></div>
        <div><label for="pf1">Power Factor</label><input id="pf1" class="input" type="number" step="0.01"></div>
        <!-- Phase 2 -->
        <h4>Phase 2</h4>
        <div><label for="v2">Voltage (V)</label><input id="v2" class="input" type="number"></div>
        <div><label for="i2">Current (A)</label><input id="i2" class="input" type="number"></div>
        <div><label for="pf2">Power Factor</label><input id="pf2" class="input" type="number" step="0.01"></div>
        <!-- Phase 3 -->
        <h4>Phase 3</h4>
        <div><label for="v3">Voltage (V)</label><input id="v3" class="input" type="number"></div>
        <div><label for="i3">Current (A)</label><input id="i3" class="input" type="number"></div>
        <div><label for="pf3">Power Factor</label><input id="pf3" class="input" type="number" step="0.01"></div>
      </div>
    </div>

    <!-- Rectifier Box -->
    <div style="flex:0.5; min-width:150px; text-align:center; position:relative;">
      <div style="width:150px; height:100px; border:2px solid #333; border-radius:8px; line-height:100px; font-weight:bold; background:#f0f0f0; margin:auto;">
        Rectifier
      </div>
      <div id="efficiencyDisplay" style="margin-top:12px; font-weight:bold;"></div>
    </div>

    <!-- Outputs Panel: DC Output -->
    <div style="flex:1; min-width:250px;">
      <h3>DC Output</h3>
      <div class="form-grid" style="gap:10px;">
        <div>
          <label for="dcV">DC Voltage (VDC)</label>
          <input id="dcV" class="input" type="number" placeholder="48">
        </div>
        <div>
          <label for="dcI">DC Current (A)</label>
          <input id="dcI" class="input" type="number" placeholder="Leave blank if unknown">
        </div>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls" style="margin-top:12px; display:flex; gap:10px;">
    <button class="btn primary" id="calcBtn">Calculate</button>
    <button class="btn ghost" id="resetBtn">Reset</button>
  </div>

  <!-- Results -->
  <div id="result" class="result" style="display:none;"></div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const result = $('result');
  const effDisp = $('efficiencyDisplay');
  const phaseType = $('phaseType');
  const singleDiv = $('singlePhaseInputs');
  const threeDiv = $('threePhaseInputs');

  phaseType.addEventListener('change', ()=>{
    if(phaseType.value==='single'){
      singleDiv.style.display='grid';
      threeDiv.style.display='none';
    }else{
      singleDiv.style.display='none';
      threeDiv.style.display='grid';
    }
    reset();
  });

  function calc(){
    let dcV=parseFloat($('dcV').value);
    let dcI=parseFloat($('dcI').value);
    let eff=null;

    let acValues=[];
    if(phaseType.value==='single'){
      acValues=[parseFloat($('acV').value),parseFloat($('acI').value),parseFloat($('pf').value)];
    } else {
      acValues=[
        parseFloat($('v1').value),parseFloat($('i1').value),parseFloat($('pf1').value),
        parseFloat($('v2').value),parseFloat($('i2').value),parseFloat($('pf2').value),
        parseFloat($('v3').value),parseFloat($('i3').value),parseFloat($('pf3').value)
      ];
    }

    let emptyCount = 0;
    acValues.forEach(v=>{if(isNaN(v)) emptyCount++;});
    if(isNaN(dcV)) emptyCount++;
    if(isNaN(dcI)) emptyCount++;

    if(emptyCount===0){
      showErr('All fields are filled. Leave one field empty to calculate.');
      return;
    }
    if(emptyCount>1){
      showErr('Please fill all fields except one (the missing parameter to calculate).');
      return;
    }

    // Calculate AC power
    let PAC=0;
    if(phaseType.value==='single'){
      let [V,I,PF]=acValues;
      PAC=V*I*PF;
    }else{
      for(let i=0;i<acValues.length;i+=3){
        let [V,I,PF]=acValues.slice(i,i+3);
        PAC+=V*I*PF;
      }
    }

    // Calculate missing DC parameter
    if(isNaN(dcV)) dcV = dcI? PAC/dcI : 0;
    if(isNaN(dcI)) dcI = dcV? PAC/dcV : 0;

    let PDC = dcV*dcI;
    eff = (PDC/PAC)*100;

    // Display results
    result.style.display='block';
    result.innerHTML=`
      <h4>Results</h4>
      <div class="small">DC Voltage: <span class="code">${dcV.toFixed(2)} V</span></div>
      <div class="small">DC Current: <span class="code">${dcI.toFixed(2)} A</span></div>
    `;
    effDisp.textContent = `Efficiency: ${eff.toFixed(2)}%`;
  }

  function reset(){
    document.querySelectorAll('input').forEach(i=>i.value='');
    result.style.display='none';
    result.innerHTML='';
    effDisp.textContent='';
  }

  function showErr(msg){
    result.style.display='block';
    result.innerHTML=`<div class="small" style="color:#c00"><strong>${msg}</strong></div>`;
    effDisp.textContent='';
  }

  $('calcBtn').addEventListener('click',calc);
  $('resetBtn').addEventListener('click',reset);
})();
</script>
