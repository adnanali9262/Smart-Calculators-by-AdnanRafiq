<div class="calculator" style="display:flex; flex-direction:column; gap:12px;">
  <h2>ðŸ”Œ Telecom Rectifier System Calculator</h2>

  <div style="display:flex; justify-content:center; align-items:center; gap:20px; flex-wrap:wrap;">

    <!-- Inputs Panel (Left) -->
    <div style="flex:1; min-width:220px;">
      <h3>AC Input</h3>
      <div class="form-grid" style="gap:10px;">
        <div>
          <label for="tr_acV">AC Voltage (VAC)</label>
          <input id="tr_acV" class="input" type="number" step="any" placeholder="230">
        </div>
        <div>
          <label for="tr_acI">AC Current (A)</label>
          <input id="tr_acI" class="input" type="number" step="any" placeholder="Leave blank if unknown">
        </div>
        <div>
          <label for="tr_pf">Power Factor</label>
          <input id="tr_pf" class="input" type="number" step="0.01" placeholder="0â€“1">
        </div>
      </div>
    </div>

    <!-- Rectifier Box -->
    <div style="position:relative; flex:0.5; min-width:150px; text-align:center;">
      <div style="width:150px; height:100px; border:2px solid #333; border-radius:8px; line-height:100px; font-weight:bold; background:#f0f0f0; margin:auto; position:relative;">
        Rectifier
      </div>
      <!-- AC â†’ Rectifier arrow -->
      <div style="position:absolute; left:-160px; top:40px; width:100px; height:4px; background:#007bff;">
        <div class="arrow" style="width:0; height:0; border-top:6px solid transparent; border-bottom:6px solid transparent; border-left:10px solid #007bff; position:absolute; right:0; top:-3px; animation:flowAC 1s linear infinite;"></div>
      </div>
      <!-- Rectifier â†’ DC arrow -->
      <div style="position:absolute; right:-160px; top:40px; width:100px; height:4px; background:#28a745;">
        <div class="arrow" style="width:0; height:0; border-top:6px solid transparent; border-bottom:6px solid transparent; border-right:10px solid #28a745; position:absolute; left:0; top:-3px; animation:flowDC 1s linear infinite;"></div>
      </div>
      <!-- Efficiency below box -->
      <div id="efficiencyDisplay" style="margin-top:12px; font-weight:bold;"></div>
    </div>

    <!-- Outputs Panel (Right) -->
    <div style="flex:1; min-width:220px;">
      <h3>DC Output</h3>
      <div class="form-grid" style="gap:10px;">
        <div>
          <label for="tr_dcV">DC Voltage (VDC)</label>
          <input id="tr_dcV" class="input" type="number" step="any" placeholder="48">
        </div>
        <div>
          <label for="tr_dcI">DC Current (A)</label>
          <input id="tr_dcI" class="input" type="number" step="any" placeholder="Leave blank if unknown">
        </div>
      </div>
    </div>

  </div>

  <!-- Controls -->
  <div class="controls" style="margin-top:12px; display:flex; gap:10px;">
    <button class="btn primary" id="tr_calc">Calculate</button>
    <button class="btn ghost" id="tr_reset">Reset</button>
  </div>

  <!-- Results -->
  <div id="tr_result" class="result" style="display:none"></div>
</div>

<style>
@keyframes flowAC { 0% { left:0; } 100% { left:90px; } }
@keyframes flowDC { 0% { left:0; } 100% { left:90px; } }
.arrow { animation-duration:1s; animation-iteration-count:infinite; }
</style>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const r = $('tr_result');
  const effDisp = $('efficiencyDisplay');

  function calc(){
    let acV = parseFloat($('tr_acV').value);
    let acI = parseFloat($('tr_acI').value);
    let pf = parseFloat($('tr_pf').value);
    let dcV = parseFloat($('tr_dcV').value);
    let dcI = parseFloat($('tr_dcI').value);

    // efficiency field handled separately below
    let eff = null;

    const values = [acV, acI, pf, dcV, dcI];
    const emptyCount = values.filter(v => isNaN(v)).length;

    if(emptyCount === 0){
      showErr('All fields are filled. Leave **one field empty** to calculate.');
      return;
    }
    if(emptyCount > 1){
      showErr('Please fill all fields except one (the missing parameter to calculate).');
      return;
    }

    let PDC = dcV && dcI ? dcV*dcI : null;
    let PAC = acV && acI && pf ? acV*acI*pf : null;

    // Calculate missing parameter
    if(isNaN(dcV) && dcI && acV && acI && pf){
      dcV = (acV*acI*pf); // compute DC assuming ideal? Better formula: PDC = PAC*eff
      PDC = dcV*dcI;
    } else if(isNaN(dcI) && dcV && acV && acI && pf){
      dcI = (acV*acI*pf) / dcV;
      PDC = dcV*dcI;
    } else if(isNaN(acI) && dcV && dcI && acV && pf){
      acI = (dcV*dcI)/(acV*pf);
      PAC = acV*acI*pf;
    } else if(isNaN(acV) && dcV && dcI && acI && pf){
      acV = (dcV*dcI)/(acI*pf);
      PAC = acV*acI*pf;
    } else if(isNaN(pf) && dcV && dcI && acV && acI){
      pf = (dcV*dcI)/(acV*acI);
      PAC = acV*acI*pf;
    }

    // Efficiency calculation
    PDC = dcV*dcI;
    PAC = acV*acI*pf;
    eff = (PDC / PAC)*100;

    // Display results
    r.style.display='block';
    r.innerHTML = `
      <h4>Results</h4>
      <div class="small">AC Voltage: <span class="code">${acV.toFixed(2)} V</span></div>
      <div class="small">AC Current: <span class="code">${acI.toFixed(2)} A</span></div>
      <div class="small">Power Factor: <span class="code">${pf.toFixed(2)}</span></div>
      <div class="small">DC Voltage: <span class="code">${dcV.toFixed(2)} V</span></div>
      <div class="small">DC Current: <span class="code">${dcI.toFixed(2)} A</span></div>
    `;

    effDisp.textContent = `Efficiency: ${eff.toFixed(2)}%`;
  }

  function reset(){
    document.querySelectorAll('#tr_acV,#tr_acI,#tr_pf,#tr_dcV,#tr_dcI').forEach(i=>i.value='');
    r.style.display='none';
    r.innerHTML='';
    effDisp.textContent='';
  }

  function showErr(msg){
    r.style.display='block';
    r.innerHTML=`<div class="small" style="color:#c00"><strong>${msg}</strong></div>`;
    effDisp.textContent='';
  }

  document.addEventListener('click', function init(){
    if($('tr_calc')){
      $('tr_calc').addEventListener('click', calc);
      $('tr_reset').addEventListener('click', reset);
      document.removeEventListener('click', init);
    }
  });
})();
</script>
