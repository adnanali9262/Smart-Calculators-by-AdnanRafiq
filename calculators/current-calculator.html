<div class="calculator">
  <h2>ðŸ“ˆ Current Calculator</h2>

  <div class="form-grid" style="margin-top:8px">
    <div>
      <label for="cc_type">Type</label>
      <select id="cc_type" class="input">
        <option value="transformer">Transformer</option>
        <option value="generator">Generator</option>
      </select>
    </div>

    <div>
      <label for="cc_phase">Phase</label>
      <select id="cc_phase" class="input">
        <option value="single">Single Phase</option>
        <option value="three">Three Phase</option>
      </select>
    </div>

    <div>
      <label for="cc_voltage" id="cc_voltageLabel">Voltage (V)</label>
      <input id="cc_voltage" class="input" type="number" step="any" placeholder="230">
    </div>

    <div>
      <label for="cc_kva">KVA</label>
      <input id="cc_kva" class="input" type="number" step="any" placeholder="10">
    </div>
  </div>

  <div class="controls" style="margin-top:12px">
    <button class="btn primary" id="cc_calc">Calculate</button>
    <button class="btn ghost" id="cc_reset">Reset</button>
  </div>

  <div id="cc_result" class="result" style="display:none"></div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const resultWrap = $('cc_result');

  function compute(){
    const type = $('cc_type').value;
    const phase = $('cc_phase').value;
    const kva = parseFloat($('cc_kva').value);
    const voltage = parseFloat($('cc_voltage').value);

    if (!kva || !voltage) {
      resultWrap.style.display='block';
      resultWrap.innerHTML = '<div class="small" style="color:#c00"><strong>Fill all fields with positive numbers.</strong></div>';
      return;
    }

    const current = phase === "single" 
      ? kva * 1000 / voltage 
      : kva * 1000 / (Math.sqrt(3) * voltage);
    const current70 = current * 0.7;

    resultWrap.style.display='block';
    resultWrap.innerHTML = `
      <h4>Results</h4>
      <div class="small">Calculated Current: <span class="code">${current.toFixed(2)} A</span></div>
      <div style="margin-top:8px"><strong>With 70% efficiency:</strong> <span style="color:green;font-size:18px">${current70.toFixed(2)} A</span></div>

      <details style="margin-top:12px">
        <summary>Calculation breakdown</summary>
        <pre class="small" style="white-space:pre-wrap;margin-top:8px">
Inputs:
  Type = ${type}
  Phase = ${phase}
  Voltage = ${voltage} V
  KVA = ${kva}

Formulas:
  Current (A) = KVA Ã— 1000 / Voltage
  Current (Single Phase) = ${phase === "single" ? `${kva} * 1000 / ${voltage}` : `${kva} * 1000 / (âˆš3 * ${voltage})`}
  Current = ${current.toFixed(6)} A
  Current with 70% efficiency = ${current70.toFixed(6)} A
        </pre>
      </details>
    `;
  }

  function reset(){
    $('cc_type').value='transformer';
    $('cc_phase').value='single';
    $('cc_voltage').value='230';
    $('cc_kva').value='10';
    resultWrap.style.display='none';
    resultWrap.innerHTML='';
    updateVoltageLabel();
  }

  function updateVoltageLabel(){
    $('cc_voltageLabel').textContent = $('cc_phase').value === 'single' 
      ? 'Voltage (Phase-to-Neutral)'
      : 'Voltage (Phase-to-Phase)';
  }

  document.addEventListener('click', function onDoc(e){
    if ($('cc_calc')) {
      $('cc_calc').addEventListener('click', compute);
      $('cc_reset').addEventListener('click', reset);
      $('cc_phase').addEventListener('change', updateVoltageLabel);
      document.removeEventListener('click', onDoc);
    }
  });

  // fallback: set defaults
  setTimeout(()=>{ if($('cc_type')) reset(); }, 50);
})();
</script>
