<div class="calculator">
  <h2>ðŸ”‹ Energy Consumption (kWh)</h2>

  <div class="form-grid" style="margin-top:8px">
    <div>
      <label for="eu_mode">Input Mode</label>
      <select id="eu_mode" class="input">
        <option value="watts">Power (Watts)</option>
        <option value="amps">Current, Voltage & PF</option>
      </select>
    </div>

    <div class="form-row">
      <div id="eu_watts_block">
        <label for="eu_power_w">Power (W)</label>
        <input id="eu_power_w" class="input" type="number" step="any" placeholder="1000">
      </div>

      <div id="eu_amps_block" style="display:none">
        <label for="eu_current">Current (A)</label>
        <input id="eu_current" class="input" type="number" step="any" placeholder="5">

        <label for="eu_voltage">Voltage (V)</label>
        <input id="eu_voltage" class="input" type="number" step="any" placeholder="230">

        <label for="eu_pf">Power Factor</label>
        <input id="eu_pf" class="input" type="number" step="any" value="0.9" min="0.1" max="1">
      </div>
    </div>

    <div>
      <label for="eu_hours">Hours per day</label>
      <input id="eu_hours" class="input" type="number" step="any" value="24">
    </div>

    <div>
      <label for="eu_days">Days (period)</label>
      <input id="eu_days" class="input" type="number" step="any" value="30">
    </div>

    <div>
      <label for="eu_cost">Cost per kWh (currency)</label>
      <input id="eu_cost" class="input" type="number" step="any" value="30">
    </div>

    <div>
      <label for="eu_tax">Tax / Surcharge (%)</label>
      <input id="eu_tax" class="input" type="number" step="any" value="0">
    </div>
  </div>

  <div class="controls" style="margin-top:12px">
    <button class="btn primary" id="eu_calc">Calculate</button>
    <button class="btn ghost" id="eu_reset">Reset</button>
  </div>

  <div id="eu_result" class="result" style="display:none"></div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  function onReady(){
    if(!$('eu_mode')) return setTimeout(onReady,50);
    const mode = $('eu_mode'), watts = $('eu_watts_block'), amps = $('eu_amps_block'), res = $('eu_result');
    mode.addEventListener('change', ()=> {
      if(mode.value==='watts'){ watts.style.display='block'; amps.style.display='none'; }
      else { watts.style.display='none'; amps.style.display='block'; }
    });

    function compute(){
      let powerW;
      if(mode.value === 'watts'){
        powerW = parseFloat($('eu_power_w').value);
        if(!powerW) return showError('Enter power in watts.');
      } else {
        const I = parseFloat($('eu_current').value), V = parseFloat($('eu_voltage').value), pf = parseFloat($('eu_pf').value);
        if(!I || !V || !pf) return showError('Enter current, voltage and power factor.');
        powerW = I * V * pf;
      }

      const hours = parseFloat($('eu_hours').value)||0, days = parseFloat($('eu_days').value)||0;
      const cost = parseFloat($('eu_cost').value)||0, taxPct = parseFloat($('eu_tax').value)||0;
      const powerKW = powerW/1000;
      const dailyKwh = powerKW * hours;
      const monthlyKwh = dailyKwh * days;
      const yearlyKwh = dailyKwh * 365;
      const dailyCost = dailyKwh * cost, monthlyCost = monthlyKwh * cost, yearlyCost = yearlyKwh * cost;
      const taxDaily = dailyCost * (taxPct/100), taxMonthly = monthlyCost * (taxPct/100), taxYearly = yearlyCost * (taxPct/100);
      const totalDaily = dailyCost + taxDaily, totalMonthly = monthlyCost + taxMonthly, totalYearly = yearlyCost + taxYearly;

      res.style.display='block';
      res.innerHTML = `
        <h4>Results</h4>
        <div class="small">Power: ${powerW.toFixed(3)} W (${powerKW.toFixed(4)} kW)</div>
        <div style="margin-top:10px"><strong>Daily:</strong> ${dailyKwh.toFixed(3)} kWh | Cost: ${totalDaily.toFixed(2)} (tax ${taxDaily.toFixed(2)})</div>
        <div style="margin-top:6px"><strong>Period (${days} days):</strong> ${monthlyKwh.toFixed(3)} kWh | Cost: ${totalMonthly.toFixed(2)} (tax ${taxMonthly.toFixed(2)})</div>
        <div style="margin-top:6px"><strong>Yearly:</strong> ${yearlyKwh.toFixed(3)} kWh | Cost: ${totalYearly.toFixed(2)} (tax ${taxYearly.toFixed(2)})</div>

        <details style="margin-top:12px"><summary>Show calculation steps</summary>
          <pre class="small" style="white-space:pre-wrap;margin-top:8px">
Inputs:
  Power (W) = ${powerW.toFixed(3)}
  Hours/day = ${hours}
  Days = ${days}
  Cost/kWh = ${cost}
  Tax% = ${taxPct}

Daily energy = (Power W / 1000) Ã— Hours = ${powerKW.toFixed(4)} Ã— ${hours} = ${dailyKwh.toFixed(3)} kWh
Period energy = ${dailyKwh.toFixed(3)} Ã— ${days} = ${monthlyKwh.toFixed(3)} kWh
Yearly energy = ${dailyKwh.toFixed(3)} Ã— 365 = ${yearlyKwh.toFixed(3)} kWh
          </pre>
        </details>
      `;
    }

    function showError(msg){ res.style.display='block'; res.innerHTML = `<div style="color:#c00"><strong>${msg}</strong></div>`; }

    function reset(){
      $('eu_mode').value='watts'; $('eu_power_w').value='1000'; $('eu_current').value=''; $('eu_voltage').value=''; $('eu_pf').value='0.9';
      $('eu_hours').value='24'; $('eu_days').value='30'; $('eu_cost').value='30'; $('eu_tax').value='0';
      watts.style.display='block'; amps.style.display='none'; res.style.display='none'; res.innerHTML='';
    }

    $('eu_calc').addEventListener('click', compute);
    $('eu_reset').addEventListener('click', reset);
    reset();
  }

  onReady();
})();
</script>
